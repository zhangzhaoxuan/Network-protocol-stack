# Network-protocol-stack

## 1 协议帧及路由过程
——————————————————————————————————————————————————————————————————————
### 1.1 概述

| 帧名    | 介绍       |
| ----- | -------- |
| RREQ  | 路由请求     |
| RREP  | 路由应答     |
| RERR  | 路由错误     |
| HELLO | 活跃路由链路检测 |
——————————————————————————————————————————————————————————————————————
  ### 1.2 RREQ帧
   (_当源节点S需要向目的节点D发送数据包时，但有没有目的节点D的路由入口时，会发送RREQ帧，RREQ帧会广播。_)

    -帧的格式
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |     Type      |J|R|G|D|U|   Reserved          |   Hop Count   |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                            RREQ ID                            |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                    Destination IP Address                     |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                  Destination Sequence Number                  |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                    Originator IP Address                      |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                  Originator Sequence Number                   |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

    -帧中字段的含义
      type : 1 (默认1)
      J : join
      R : repair
      G : Gratuitous RREP (免费路由回复标记)  说明是否应该向目标节点发送一个路由回复的报文
      D : 仅允许目的节点进行回复
      U : 指示目标节点序列号未知
      Reserved : 填充0 会被接收端忽视的字段
      Hop Count : 从发起节点到处理该节点请求的跳数
      RREQ ID : ID
      Destination IP Address : 目的节点IP地址
      Destination Sequence Number : 目标节点序列号 发起节点在以前能通向目的节点的节点中找到的最新的序列号
      Originator IP Address : 发起本条路由请求信息的IP地址
      Originator Sequence Number : 发起者的路由表中现在正在使用的序列号
——————————————————————————————————————————————————————————————————————
  ### 1.3 RREP帧
  (_当RREQ到达时，目的节点发送的反向路由帧，使用这个帧来使网络上的各个节点建立前一个节点的路由，节点只对收到的第一次RREQ产生反应，重复发送的RREQ将不能产生重复的RREP帧_)


     -帧的格式
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |     Type      |R|A|    Reserved     |Prefix Sz|   Hop Count   |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                     Destination IP address                    |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                  Destination Sequence Number                  |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                    Originator IP address                      |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                           Lifetime                            |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

    -帧中字段的含义
      type : 2 (默认2)
      R : repair
      A : acknowledgment required (需要确认)
      Reserved : 填充0 会被接收端忽视的字段
      Prefix SZ : 前缀长度 值为 0 - 31 前缀指的是 IPV4地址 - 主机地址的长度
      Hop Count : 从发起节点到处理该节点请求的跳数
      Destination IP Address : 目的节点IP地址
      Destination Sequence Number : 目标节点序列号 从路由表中查找对应的序列号
      Originator IP Address : 发起本条路由请求信息的IP地址
      lifetime 生命时长 在规定的这段时间中 接受到这条消息的节点将认为这条路径是可用的

——————————————————————————————————————————————————————————————————————
  ### 1.4RERR帧
  (_路由错误帧，用来进行路由的错误控制_)



       -帧的格式
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |     Type      |N|          Reserved           |   DestCount   |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |            Unreachable Destination IP Address (1)             |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |         Unreachable Destination Sequence Number (1)           |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-|
    |  Additional Unreachable Destination IP Addresses (if needed)  |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |Additional Unreachable Destination Sequence Numbers (if needed)|
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

      -帧中字段的含义
        type : 3 (默认3)
        N : No delete 当上一个节点对这个连接做了本地修复，就将这个标志位置真，也即不用删除这个路由
        Reserved : 填充0 会被接收端忽视的字段    
        DestCount : 本消息内包含的不可达目的节点的数目
        Unreachable Destination IP Address : 不能到的节点目的节点IP地址
        Unreachable Destination Sequence Number : 与上面的目标节点对应的序列号
        Additional : 可以包含多个不可达节点，用来表示多个不可达节点有一个 加一对儿消息
——————————————————————————————————————————————————————————————————————

  ### 1.5 HELLO 消息
  (_hello 消息实际上就是就是TTL为一的RREP消息_)
——————————————————————————————————————————————————————————————————————

## 2 路由表

    - 目的节点 ip 地址
    - 目的节点序号
    - 目的节点序列号是否正确的标记
    - 其他状态和路由标记
    - 跳数
    - 下一跳
    - 先驱表
    - 生命（路由过期或者应当删除的时间）

## 3 代码介绍

### 文件介绍

| 文件              | 说明                 |
| --------------- | ------------------ |
| list.h          | 定义链表结构             |
| routing_table.h | 路由表定义              |
| aodv_hello.c    | hello 消息           |
| aodv_neighbor.c | 添加邻居节点并且处理邻居节点断开事件 |
| aodv_rerr.c     | rerr 消息的定义发送及处理    |
| aodv_rrep.c     | rrep 消息的定义发送及处理    |
| aodv_rreq.c     | rreq 消息的定义发送及处理    |
| aodv_socket.c   | 处理aodv的socket套接字   |
| aodv_timeout.c  | 超时处理               |

### 2.2 全局变量

| 变量  | 数据类型 | 说明  |
| --- | ---- | --- |
